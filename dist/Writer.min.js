var t=(t,e)=>("string"==typeof t&&(t=document.querySelector(t)),{isInFirstLine(){const t=e.containerRect();return this.rect().top===t.top},isInLastLine(){const t=e.containerRect();return this.rect().bottom===t.bottom},rect(){let t=e.range().cloneRange();return t.collapse(),t.getBoundingClientRect()},set:t=>e.select(t),position:()=>e.start()}),e={bold:{html:t=>`<strong>${t}</strong>`,parser(t){if(["B","STRONG"].includes(t.nodeName))return!0;return!!["bold","bolder","500","600","700","800","900"].includes(t.style.fontWeight)}},code:{html:t=>`<code>${t}</code>`,parser:t=>"CODE"===t.nodeName},italic:{html:t=>`<em>${t}</em>`,parser:t=>!!["I","EM"].includes(t.nodeName)||"italic"===t.style.fontStyle},link:{html(t,e={}){if(!e.href)return t;let n=`href="${e.href}"`,r='rel="noopener noreferrer"';return e.rel&&(r=`rel="noopener noreferrer ${e.rel}"`),e.target&&(n+=` target="${e.target}"`),e.title&&(n+=` title="${e.title}"`),`<a ${n} ${r}>${t}</a>`},parser(t){if("A"!==t.nodeName)return!1;const e=t.getAttribute("href");return!!e&&{href:e,rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}}},strikeThrough:{html:t=>`<del>${t}</del>`,parser:t=>"DEL"===t.nodeName||"line-through"===t.style.textDecoration},subscript:{html:t=>`<sub>${t}</sub>`,parser:t=>"SUB"===t.nodeName||"sub"===t.style.verticalAlign},superscript:{html:t=>`<sup>${t}</sup>`,parser:t=>"SUP"===t.nodeName||"super"===t.style.verticalAlign}},n=t=>JSON.parse(JSON.stringify(t));const r=t=>t[t.length-1];class o{constructor(t){this.UNDO_HISTORY=[],this.REDO_HISTORY=[],this.limit=t>0?t+1:100}push(){var t,e;return(t=arguments,Array.prototype.slice.call(t,e)).forEach(t=>{[void 0!==t,r(this.UNDO_HISTORY)!==t].every(Boolean)&&this.UNDO_HISTORY.push(t),this.UNDO_HISTORY.length>this.limit&&this.UNDO_HISTORY.shift(),this.REDO_HISTORY=[]}),this}redo(){if(this.REDO_HISTORY.length>0){const t=this.REDO_HISTORY.pop();return this.UNDO_HISTORY.push(t),t}}undo(){if(this.UNDO_HISTORY.length>0){const t=this.UNDO_HISTORY.pop();return this.REDO_HISTORY.push(t),r(this.UNDO_HISTORY)}}get canUndo(){return this.UNDO_HISTORY.length>1}get canRedo(){return this.REDO_HISTORY.length>0}log(){console.log("UNDO:",this.UNDO_HISTORY),console.log("REDO:",this.REDO_HISTORY)}}var s=(t,e={})=>{"string"==typeof t&&(t=document.querySelector(t));const r=["b","big","i","small","tt","abbr","acronym","cite","code","del","dfn","em","kbd","strong","samp","var","a","bdo","br","img","map","object","q","script","span","sub","sup","button","input","label","select","textarea"],o=(t,e={})=>{let n=[];return Array.from(t.childNodes).forEach(t=>{if("#text"===t.nodeName)n.push(...((t,e={})=>{let n=[];return Object.keys(e).forEach(t=>{!1===e[t]&&delete e[t]}),[...t.data].forEach(t=>{n.push({text:t,format:e})}),n})(t,e));else if("BR"===t.nodeName)n.push({text:"\n",format:{}});else{const i=s(t,e);n.push(...o(t,i)),!1===r.includes(t.nodeName.toLowerCase())&&n.push({text:" ",format:{}})}}),n},s=(t,n)=>{let r={};return Object.keys(e).forEach(o=>{if(!0!==n[o]&&"object"!=typeof n[o])if(e[o]&&e[o].parser){const s=e[o].parser(t,n);s&&(r[o]=s)}else console.error(`The parser for ${o} does not exist`);else r[o]=n[o]}),r};return n(o(t))},i=(t,e={})=>{const r={formats:{},history:100,onCommit:()=>{},onRedo:()=>{},onUndo:()=>{},...e},i=(a=r.history,new o(a));var a;let l=t?s(t,r.formats):[];const c=(t,e,n,r)=>{e=R(e),n=n||y(e);for(let o=e;o<e+n;o++)l[o]&&(l[o].format[t]=r||!0);h(l,"addFormat",{format:t,attributes:r,start:e,length:n})},u=()=>n(l),h=(t,e,n)=>{v(t,e,n),r.onCommit(t,e,n),O(t)},d=t=>!1===Number.isInteger(t)||-1===t?l.length-1:t,f=(t,e)=>{t=R(t),e=e||y(t);let n=[];for(let r=t;r<t+e;r++)l[r]&&n.push(l[r]);return n},g=(t,e,n)=>{e=R(e),n=n||y(e);for(let r=e;r<e+n;r++)if(null!=l[r].format[t]==!1)return!1;return!0},p=(t,e)=>{if(0===t.length)return;if(t.length>1)return void[...t].forEach(t=>{p(t,e),e++});e=Number.isInteger(e)?e:l.length;const n=l[e]?l[e].format:{};l.splice(e,0,{text:t,format:n}),h(l,"insertText",{text:t,start:e+1})},m=()=>l.length,y=t=>{t=t||0;let e=m()-t;return e<0?0:e},N=(t,e)=>{const r=i[t]();r&&(l=n(r.doc),e(r.doc,r.action,r.args))},v=(t,e,r)=>{i.push({doc:n(t),action:e,args:r})},b=(t,e,n)=>{e=R(e),n=n||y(e);for(let r=e;r<e+n;r++)delete l[r].format[t];h(l,"removeFormat",{format:t,start:e,length:n})},O=t=>(l=n(t),l),R=t=>Number.isInteger(t)?t:0,E=(t,e)=>{t=R(t),e=e||y(t);const n=u().slice(t,e);let r=[],o=-1;return n.forEach((t,e)=>{const s=n[e-1]||{},i=JSON.stringify({format:s.format}),a=JSON.stringify({format:t.format});n[e-1]&&i===a?r[o]&&(r[o].text+=t.text):(r.push({...t}),o++)}),r};return v(l,"init",{}),{activeFormats:(t,e)=>{t=R(t),e=e||y(t);let n=[];for(let r=t;r<t+e;r++){const o=l[r];o&&Object.keys(o.format).forEach(r=>{!1===n.includes(r)&&g(r,t,e)&&n.push(r)})}return n},activeLink:(t,e)=>{let n=!1;return f(t,e).forEach(t=>{Object.keys(t.format).forEach(e=>{"link"===e&&(n=t.format.link)})}),n},addFormat:c,append:t=>{l=l.concat(t),h(l,"append",{content:t})},clone:u,doc:l,get:f,hasFormat:g,inject:(t,e)=>{e=d(e),l=[...l.slice(0,e),...t,...l.slice(e)],h(l,"inject",{items:t,start:e+1})},insertText:p,length:m,lengthAfter:y,redo:()=>{N("redo",r.onRedo)},removeFormat:b,removeFormats:(t,e)=>{t=R(t),e=e||y(t);for(let n=t;n<t+e;n++)l[n].format={};h(l,"removeFormats",{start:t,length:e})},removeText:(t,e)=>{t=d(t),e=!e||e<1?1:e,l.splice(t,e),h(l,"removeText",{position:t,length:e})},replace:O,toggleFormat:(t,e,n,r)=>{g(t,e,n)?b(t,e,n):c(t,e,n,r)},toHtml:(t,e)=>{t=R(t),e=e||y(t);let n=[];return E(t,e).forEach(t=>{n.push((t=>{const e=Object.keys(t.format||{});let n=document.createElement("p");n.textContent=t.text;let o=n.innerHTML;return 0===e.length||e.forEach(e=>{o=r.formats[e]?r.formats[e].html(o,t.format[e]):t.text}),o})(t))}),n=n.join(""),"\n"===n.slice(-1)&&(n+="&nbsp;"),n},toJson:E,toText:(t,e)=>{t=R(t),e=e||y(t);let n="";return u().slice(t,e).forEach(t=>{n+=t.text}),n},undo:()=>{N("undo",r.onUndo)}}};(function(){var t,e,n,r,o,s,i=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};(t={}).Range=function(){function i(t,e){this.set(t,e)}return i.prototype.isCollapsed=function(){return this._from===this._to},i.prototype.span=function(){return this._to-this._from},i.prototype.collapse=function(){return this._to=this._from},i.prototype.eq=function(t){return this.get()[0]===t.get()[0]&&this.get()[1]===t.get()[1]},i.prototype.get=function(){return[this._from,this._to]},i.prototype.select=function(e){var n,o,s,i,a,l,c,u,h;return t.Range.unselectAll(),n=document.createRange(),a=(u=r(e,this._from))[0],c=u[1],o=(h=r(e,this._to))[0],i=h[1],l=a.length||0,s=o.length||0,n.setStart(a,Math.min(c,l)),n.setEnd(o,Math.min(i,s)),window.getSelection().addRange(n)},i.prototype.set=function(t,e){return t=Math.max(0,t),e=Math.max(0,e),this._from=Math.min(t,e),this._to=Math.max(t,e)},i.prepareElement=function(t){var n,r,o,s,i,a;for(a=[],n=s=0,i=(o=t.querySelectorAll(e.join(", "))).length;s<i;n=++s)(r=o[n]).parentNode.insertBefore(document.createTextNode(""),r),n<o.length-1?a.push(r.parentNode.insertBefore(document.createTextNode(""),r.nextSibling)):a.push(void 0);return a},i.query=function(e){var r,i,a,l,c,u,h;l=new t.Range(0,0);try{r=window.getSelection().getRangeAt(0)}catch(t){return l}return null===e.firstChild&&null===e.lastChild?l:n(r.startContainer,e)&&n(r.endContainer,e)?(c=(h=o(e,r))[0],u=h[1],i=h[2],a=h[3],l.set(s(e,c)+u,s(e,i)+a),l):l},i.rect=function(){var t,e,n;try{t=window.getSelection().getRangeAt(0)}catch(t){return null}return t.collapsed?(e=document.createElement("span"),t.insertNode(e),n=e.getBoundingClientRect(),e.parentNode.removeChild(e),n):t.getBoundingClientRect()},i.unselectAll=function(){if(window.getSelection())return window.getSelection().removeAllRanges()},i}(),e=["br","img","input"],n=function(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},r=function(t,n){var r,o,s,a,l;if(0===t.childNodes.length)return[t,n];for(r=null,o=n,s=function(){var e,n,r,o;for(o=[],e=0,n=(r=t.childNodes).length;e<n;e++)a=r[e],o.push(a);return o}();s.length>0;)switch((r=s.shift()).nodeType){case Node.TEXT_NODE:if(r.textContent.length>=o)return[r,o];o-=r.textContent.length;break;case Node.ELEMENT_NODE:if(l=r.nodeName.toLowerCase(),i.call(e,l)>=0){if(0===o)return[r,0];o=Math.max(0,o-1)}else r.childNodes&&Array.prototype.unshift.apply(s,function(){var t,e,n,o;for(o=[],t=0,e=(n=r.childNodes).length;t<e;t++)a=n[t],o.push(a);return o}())}return[r,o]},s=function(t,n){var r,o,s,a,l,c;if(0===t.childNodes.length)return 0;for(s=0,r=function(){var e,n,r,s;for(s=[],e=0,n=(r=t.childNodes).length;e<n;e++)o=r[e],s.push(o);return s}();r.length>0;){if((a=r.shift())===n)return l=a.nodeName.toLowerCase(),i.call(e,l)>=0?s+1:s;switch(a.nodeType){case Node.TEXT_NODE:s+=a.textContent.length;break;case Node.ELEMENT_NODE:c=a.nodeName.toLowerCase(),i.call(e,c)>=0?s+=1:a.childNodes&&Array.prototype.unshift.apply(r,function(){var t,e,n,r;for(r=[],t=0,e=(n=a.childNodes).length;t<e;t++)o=n[t],r.push(o);return r}())}}return s},o=function(t,n){var r,o,s,a,l,c,u,h,d,f,g,p,m,y;if(o=t.childNodes,(d=n.cloneRange()).collapse(!0),(l=n.cloneRange()).collapse(!1),u=d.startContainer,h=d.startOffset,s=l.endContainer,a=l.endOffset,!d.comparePoint)return[u,h,s,a];if(u===t)for(h=(u=o[o.length-1]).textContent.length,c=f=0,p=o.length;f<p;c=++f)if(r=o[c],1===d.comparePoint(r,0)){0===c?(u=r,h=0):(u=o[c-1],h=r.textContent.length),y=u.nodeName.toLowerCase,i.call(e,y)>=0&&(h=1);break}if(n.collapsed)return[u,h,u,h];if(s===t)for(a=(s=o[o.length-1]).textContent.length,c=g=0,m=o.length;g<m;c=++g)r=o[c],1===l.comparePoint(r,0)&&(s=0===c?r:o[c-1],a=r.textContent.length+1);return[u,h,s,a]},"undefined"!=typeof window&&(window.ContentSelect=t),"undefined"!=typeof module&&module.exports&&(module.exports=t)}).call(void 0);var a=t=>("string"==typeof t&&(t=document.querySelector(t)),{ancestor(){const e=this.range();return e?e.commonAncestorContainer:t},container:()=>t,containerRect(){const e=document.createRange();return e.selectNodeContents(t),e.getBoundingClientRect()},end(){return this.start()+this.length()},isWithin(){if(!this.range())return!1;const e=this.ancestor();return e===t||t.contains(e)},length(){return this.text().length},object:()=>document.getSelection(),range(t=!1){const e=this.object();let n=null;if(!e)return null;try{n=e.getRangeAt(0)}catch(t){return null}return!0===t?n.cloneRange():n},rangeAfterCursor(){const e=this.range(),n=this.range(!0);return e&&n?(n.selectNodeContents(t),n.setStart(e.endContainer,e.endOffset),n):null},rangeBeforeCursor(){const e=this.range(),n=this.range(!0);return e&&n?(n.selectNodeContents(t),n.setEnd(e.startContainer,e.startOffset),n):null},rect(){const t=this.range();return!!t&&t.getBoundingClientRect()},select(e,n){n=n||e,new ContentSelect.Range(e,n).select(t)},start(){const t=this.rangeBeforeCursor();return t?t.toString().length:0},text(){const t=this.range();return t?t.toString():""}});export default(n,r)=>{"string"==typeof n&&(n=document.querySelector(n));const o={breaks:!0,formats:{},history:100,onBlur:()=>{},onChange:()=>{},onFocus:()=>{},onKeydown:()=>{},onKeyup:()=>{},onMousedown:()=>{},onMouseup:()=>{},onRedo:()=>{},onSelection:()=>{},onSelectionEnd:()=>{},onSelectionStart:()=>{},onUndo:()=>{},placeholder:"",shortcuts:{},spellcheck:!0,...r},l={...e,...o.formats},c=(t,e,n)=>{R(),n&&n.start&&b(n.start,n.length)},u=i(n,{formats:l,history:o.history,onRedo:(t,e,n)=>{c(0,0,n),o.onRedo(t,e,n)},onUndo:(t,e,n)=>{c(0,0,n),o.onUndo(t,e,n)}}),h=a(n),d=t(n,h);let f=!1;n.setAttribute("contenteditable",!0),n.setAttribute("data-placeholder",o.placeholder),n.setAttribute("spellcheck",o.spellcheck);const g={bold(){m("bold")},code(){m("code")},delete(){let t=h.start(),e=h.length();0===e&&(t-=1,e=1),u.removeText(t,e),R(),b(t)},deleteForward(){let t=h.start(),e=h.length();0===e&&(e=1),u.removeText(t,e),R(),b(t)},enter(){if(!0!==o.breaks)return!1;const t=d.position();u.insertText("\n",t),R(),b(t+1)},insert(t,e){u.insertText(t,e),R(),b(e+t.length)},italic(){m("italic")},link(t){const e=h.start(),n=h.length();u.addFormat("link",e,n,{href:t}),R(),b(e,n)},paste(t){let e=d.position(),n=document.createElement("div");n.innerHTML=t;const r=s(n,l);u.inject(r,e),R(),b(e+r.length)},strikeThrough(){m("strikeThrough")},subscript(){m("subscript")},superscript(){m("superscript")},unlink(){const t=h.start(),e=h.length();u.removeFormat("link",t,e),R(),b(t,e)}},p=(t,...e)=>"function"==typeof t?t.call(...e):g[t]?g[t](...e):void 0,m=(t,e)=>{const n=h.start(),r=h.length();u.toggleFormat(t,n,r,e),R(),b(n,r)},y=()=>{!0===f&&(f=!1,o.onSelectionEnd(event))},N=()=>{!1===f&&(f=!0,o.onSelectionStart(event))},v=()=>{u.redo()},b=(t,e)=>{f=!0,h.select(t,t+(e||0))},O=()=>{u.undo()},R=()=>{const t=u.toHtml();n.innerHTML=t,o.onChange(t)};n.addEventListener("blur",o.onBlur),n.addEventListener("focus",o.onFocus),n.addEventListener("mousedown",o.onMousedown),document.addEventListener("selectionchange",t=>{h.isWithin()?(N(),o.onSelection(t)):y()}),n.addEventListener("mouseup",t=>{o.onMouseup(t),y()}),n.addEventListener("keyup",t=>{o.onKeyup(t),y()});const E={Delete:"deleteForward",Backspace:"delete",Enter:"enter","Meta+b":"bold","Meta+i":"italic","Meta+x":"delete","Shift+Enter":"enter",...o.shortcuts||{}};return n.addEventListener("paste",t=>{t.preventDefault();const e=t.clipboardData||window.clipboardData,n=e.getData("text/html")||e.getData("text");p("paste",n)}),n.addEventListener("keydown",t=>{o.onKeydown(t);let e=[];if(!0===t.metaKey&&e.push("Meta"),!0===t.altKey&&e.push("Alt"),!0===t.ctrlKey&&e.push("Ctrl"),!0===t.shiftKey&&e.push("Shift"),e.push(t.key),e=e.join("+"),["Backspace","Delete"].includes(t.key)&&(e=t.key),"Meta+z"===e)return t.preventDefault(),void O();if("Meta+Shift+z"===e)return t.preventDefault(),void v();if(h.start()!==h.end()&&!1===t.ctrlKey&&!1===t.metaKey&&1===t.key.length&&p("delete"),E[e]){p(E[e])||t.preventDefault()}}),n.addEventListener("input",t=>{switch(t.inputType){case"historyRedo":v();break;case"historyUndo":O();break;case"insertText":p("insert",t.data,d.position()-1)}}),n.innerHTML=u.toHtml(),{activeFormats:()=>{const t=h.start(),e=h.length();return u.activeFormats(t,e)},activeLink:()=>{const t=h.start(),e=h.length();return u.activeLink(t,e)},command:p,cursor:d,doc:u,element:n,options:o,redo:v,select:b,selection:h,toHtml:(t,e)=>u.toHtml(t,e),toJson:(t,e)=>u.toJson(t,e),toText:(t,e)=>u.toText(t,e),undo:O,update:R}};
