var e=(e,t)=>("string"==typeof e&&(e=document.querySelector(e)),{isInFirstLine(){const e=t.containerRect();return this.rect().top===e.top},isInLastLine(){const e=t.containerRect();return this.rect().bottom===e.bottom},rect(){let e=t.range().cloneRange();return e.collapse(),e.getBoundingClientRect()},set:e=>t.select(e),position:()=>t.start()}),t={bold:{html:e=>`<strong>${e}</strong>`,parser(e){if(["B","H1","H2","H3","H4","H5","H6","STRONG"].includes(e.nodeName))return!0;return!!["bold","bolder","500","600","700","800","900"].includes(e.style.fontWeight)}},code:{html:e=>`<code>${e}</code>`,parser:e=>"CODE"===e.nodeName},italic:{html:e=>`<em>${e}</em>`,parser:e=>!!["I","EM"].includes(e.nodeName)||"italic"===e.style.fontStyle},link:{html(e,t={}){if(!t.href)return e;let n=`href="${t.href}"`,r='rel="noopener noreferrer"';return t.rel&&(r=`rel="noopener noreferrer ${t.rel}"`),t.target&&(n+=` target="${t.target}"`),t.title&&(n+=` title="${t.title}"`),`<a ${n} ${r}>${e}</a>`},parser(e){if("A"!==e.nodeName)return!1;const t=e.getAttribute("href");return!!t&&{href:t,rel:e.getAttribute("rel"),target:e.getAttribute("target"),title:e.getAttribute("title")}}},strikeThrough:{html:e=>`<del>${e}</del>`,parser:e=>"DEL"===e.nodeName||"line-through"===e.style.textDecoration},subscript:{html:e=>`<sub>${e}</sub>`,parser:e=>"SUB"===e.nodeName||"sub"===e.style.verticalAlign},superscript:{html:e=>`<sup>${e}</sup>`,parser:e=>"SUP"===e.nodeName||"super"===e.style.verticalAlign}},n=e=>JSON.parse(JSON.stringify(e));const r=e=>e[e.length-1];class o{constructor(e){this.UNDO_HISTORY=[],this.REDO_HISTORY=[],this.limit=e>0?e+1:100}push(){var e,t;return(e=arguments,Array.prototype.slice.call(e,t)).forEach(e=>{[void 0!==e,r(this.UNDO_HISTORY)!==e].every(Boolean)&&this.UNDO_HISTORY.push(e),this.UNDO_HISTORY.length>this.limit&&this.UNDO_HISTORY.shift(),this.REDO_HISTORY=[]}),this}redo(){if(this.REDO_HISTORY.length>0){const e=this.REDO_HISTORY.pop();return this.UNDO_HISTORY.push(e),e}}undo(){if(this.UNDO_HISTORY.length>0){const e=this.UNDO_HISTORY.pop();return this.REDO_HISTORY.push(e),r(this.UNDO_HISTORY)}}get canUndo(){return this.UNDO_HISTORY.length>1}get canRedo(){return this.REDO_HISTORY.length>0}log(){console.log("UNDO:",this.UNDO_HISTORY),console.log("REDO:",this.REDO_HISTORY)}}var s=(e,t={})=>{"string"==typeof e&&(e=document.querySelector(e));const r=(e,t={})=>{let n=[];return Array.from(e.childNodes).forEach(e=>{if("#text"===e.nodeName)n.push(...((e,t={})=>{let n=[];return Object.keys(t).forEach(e=>{!1===t[e]&&delete t[e]}),[...e.data].forEach(e=>{n.push({text:e,format:t})}),n})(e,t));else{const s=o(e,t);n.push(...r(e,s))}}),n},o=(e,n)=>{let r={};return Object.keys(t).forEach(o=>{if(!0!==n[o]&&"object"!=typeof n[o])if(t[o]&&t[o].parser){const s=t[o].parser(e,n);s&&(r[o]=s)}else console.error(`The parser for ${o} does not exist`);else r[o]=n[o]}),r},s=((e,t)=>{const n=e=>t.includes(e.nodeName.toLowerCase()),r=e=>{if(0===e.children.length)return!1;let t=!1;return Array.from(e.children).forEach(e=>{!1!==n(e)?r(e)&&(t=!0):t=!0}),t};let o=[];const s=e=>{let t=e.innerHTML.trim().replace(/[ ]{2,}/g,"").replace(/[\n]{3,}/g,"\n\n");return e.innerHTML=t,e},i=["H1","H2","H3","H4","H5","H6"];Array.from(e.querySelectorAll(["area","base","col","command","embed","hr","img","input","keygen","link","menuitem","meta","param","object","source","svg","track","video","wbr"].join(","))).forEach(e=>{e.parentNode.removeChild(e)});const a=e=>{if(!1!==r(e))Array.from(e.children).forEach(e=>{a(e),!1===n(e)&&(s(e),!1===i.includes(e.nodeName)&&(e=>{const t=e.parentNode;for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)})(e))});else{if(s(e),""===e.innerHTML)return;i.includes(e.nodeName)?o.push(e.outerHTML):o.push(e.innerHTML)}};return a(e),o.join("\n\n")})(e,["a","abbr","acronym","b","bdo","big","br","button","cite","code","del","dfn","em","i","img","input","kbd","label","map","object","q","samp","script","select","small","span","strong","sub","sup","textarea","tt","var"]);let i=document.createElement("div");return i.innerHTML=s,n(r(i))},i=(e,t={})=>{const r={formats:{},history:100,onCommit:()=>{},onRedo:()=>{},onUndo:()=>{},triggers:{}},i={...r,...t},a=(l=i.history,new o(l));var l;const c={...r.triggers,...t.triggers||{}},u=Object.keys(c),h=Math.max(...u.map(e=>e.length));let d;d=!0===Array.isArray(e)?e:e?s(e,i.formats):[];const f=(e,t,n,r)=>{t=x(t),n=n||E(t);for(let o=t;o<t+n;o++)d[o]&&(d[o].format[e]=r||!0);p(d,"addFormat",{format:e,attributes:r,start:t,length:n})},g=()=>n(d),p=(e,t,n)=>{R(e,t,n),i.onCommit(e,t,n),T(e)},m=e=>!1===Number.isInteger(e)||-1===e?d.length-1:e,y=(e,t)=>{e=x(e),t=t||E(e);let n=[];for(let r=e;r<e+t;r++)d[r]&&n.push(d[r]);return n},v=(e,t,n)=>{t=x(t),n=n||E(t);for(let r=t;r<t+n;r++)if(null!=d[r].format[e]==!1)return!1;return!0},N=(e,t)=>{if(0===e.length)return;if(e.length>1)return void[...e].forEach(e=>{N(e,t),t++});t=Number.isInteger(t)?t:d.length;const n=d[t]?d[t].format:{};if(d.splice(t,0,{text:e,format:n}),u.length&&d.length<=h){const e=d.map(e=>e.text).join("");u.some(t=>{if(e===t)return c[t](),!0})}p(d,"insertText",{text:e,start:t+1})},b=()=>d.length,E=e=>{e=e||0;let t=b()-e;return t<0?0:t},O=(e,t)=>{const r=a[e]();r&&(d=n(r.doc),t(r.doc,r.action,r.args))},R=(e,t,r)=>{a.push({doc:n(e),action:t,args:r})},S=(e,t,n)=>{t=x(t),n=n||E(t);for(let r=t;r<t+n;r++)delete d[r].format[e];p(d,"removeFormat",{format:e,start:t,length:n})},T=e=>(d=n(e),d),x=e=>Number.isInteger(e)?e:0,C=(e,t)=>{e=x(e),t=t||E(e);const n=g().slice(e,t);let r=[],o=-1;return n.forEach((e,t)=>{const s=n[t-1]||{},i=JSON.stringify({format:s.format}),a=JSON.stringify({format:e.format});n[t-1]&&i===a?r[o]&&(r[o].text+=e.text):(r.push({...e}),o++)}),r};return R(d,"init",{}),{activeFormats:(e,t)=>{e=x(e),t=t||E(e);let n=[];for(let r=e;r<e+t;r++){const o=d[r];o&&Object.keys(o.format).forEach(r=>{!1===n.includes(r)&&v(r,e,t)&&n.push(r)})}return n},activeLink:(e,t)=>{let n=!1;return y(e,t).forEach(e=>{Object.keys(e.format).forEach(t=>{"link"===t&&(n=e.format.link)})}),n},addFormat:f,append:e=>{d=d.concat(e),p(d,"append",{content:e})},clone:g,doc:d,get:y,hasFormat:v,inject:(e,t)=>{t=m(t),d=[...d.slice(0,t),...e,...d.slice(t)],p(d,"inject",{items:e,start:t+1})},insertText:N,length:b,lengthAfter:E,redo:()=>{O("redo",i.onRedo)},removeFormat:S,removeFormats:(e,t)=>{e=x(e),t=t||E(e);for(let n=e;n<e+t;n++)d[n].format={};p(d,"removeFormats",{start:e,length:t})},removeText:(e,t)=>{e=m(e),t=!t||t<1?1:t,d.splice(e,t),p(d,"removeText",{position:e,length:t})},replace:T,toggleFormat:(e,t,n,r)=>{v(e,t,n)?S(e,t,n):f(e,t,n,r)},toHtml:(e,t)=>{e=x(e),t=t||E(e);let n=[];return C(e,t).forEach(e=>{n.push((e=>{const t=Object.keys(e.format||{});let n=document.createElement("p");n.textContent=e.text;let r=n.innerHTML;return 0===t.length||t.forEach(t=>{r=i.formats[t]?i.formats[t].html(r,e.format[t]):e.text}),r})(e))}),n=n.join(""),"\n"===n.slice(-1)&&(n+="&nbsp;"),n},toJson:C,toText:(e,t)=>{e=x(e),t=t||E(e);let n="";return g().slice(e,t).forEach(e=>{n+=e.text}),n},undo:()=>{O("undo",i.onUndo)}}};(function(){var e,t,n,r,o,s,i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};(e={}).Range=function(){function i(e,t){this.set(e,t)}return i.prototype.isCollapsed=function(){return this._from===this._to},i.prototype.span=function(){return this._to-this._from},i.prototype.collapse=function(){return this._to=this._from},i.prototype.eq=function(e){return this.get()[0]===e.get()[0]&&this.get()[1]===e.get()[1]},i.prototype.get=function(){return[this._from,this._to]},i.prototype.select=function(t){var n,o,s,i,a,l,c,u,h;return e.Range.unselectAll(),n=document.createRange(),a=(u=r(t,this._from))[0],c=u[1],o=(h=r(t,this._to))[0],i=h[1],l=a.length||0,s=o.length||0,n.setStart(a,Math.min(c,l)),n.setEnd(o,Math.min(i,s)),window.getSelection().addRange(n)},i.prototype.set=function(e,t){return e=Math.max(0,e),t=Math.max(0,t),this._from=Math.min(e,t),this._to=Math.max(e,t)},i.prepareElement=function(e){var n,r,o,s,i,a;for(a=[],n=s=0,i=(o=e.querySelectorAll(t.join(", "))).length;s<i;n=++s)(r=o[n]).parentNode.insertBefore(document.createTextNode(""),r),n<o.length-1?a.push(r.parentNode.insertBefore(document.createTextNode(""),r.nextSibling)):a.push(void 0);return a},i.query=function(t){var r,i,a,l,c,u,h;l=new e.Range(0,0);try{r=window.getSelection().getRangeAt(0)}catch(e){return l}return null===t.firstChild&&null===t.lastChild?l:n(r.startContainer,t)&&n(r.endContainer,t)?(c=(h=o(t,r))[0],u=h[1],i=h[2],a=h[3],l.set(s(t,c)+u,s(t,i)+a),l):l},i.rect=function(){var e,t,n;try{e=window.getSelection().getRangeAt(0)}catch(e){return null}return e.collapsed?(t=document.createElement("span"),e.insertNode(t),n=t.getBoundingClientRect(),t.parentNode.removeChild(t),n):e.getBoundingClientRect()},i.unselectAll=function(){if(window.getSelection())return window.getSelection().removeAllRanges()},i}(),t=["br","img","input"],n=function(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1},r=function(e,n){var r,o,s,a,l;if(0===e.childNodes.length)return[e,n];for(r=null,o=n,s=function(){var t,n,r,o;for(o=[],t=0,n=(r=e.childNodes).length;t<n;t++)a=r[t],o.push(a);return o}();s.length>0;)switch((r=s.shift()).nodeType){case Node.TEXT_NODE:if(r.textContent.length>=o)return[r,o];o-=r.textContent.length;break;case Node.ELEMENT_NODE:if(l=r.nodeName.toLowerCase(),i.call(t,l)>=0){if(0===o)return[r,0];o=Math.max(0,o-1)}else r.childNodes&&Array.prototype.unshift.apply(s,function(){var e,t,n,o;for(o=[],e=0,t=(n=r.childNodes).length;e<t;e++)a=n[e],o.push(a);return o}())}return[r,o]},s=function(e,n){var r,o,s,a,l,c;if(0===e.childNodes.length)return 0;for(s=0,r=function(){var t,n,r,s;for(s=[],t=0,n=(r=e.childNodes).length;t<n;t++)o=r[t],s.push(o);return s}();r.length>0;){if((a=r.shift())===n)return l=a.nodeName.toLowerCase(),i.call(t,l)>=0?s+1:s;switch(a.nodeType){case Node.TEXT_NODE:s+=a.textContent.length;break;case Node.ELEMENT_NODE:c=a.nodeName.toLowerCase(),i.call(t,c)>=0?s+=1:a.childNodes&&Array.prototype.unshift.apply(r,function(){var e,t,n,r;for(r=[],e=0,t=(n=a.childNodes).length;e<t;e++)o=n[e],r.push(o);return r}())}}return s},o=function(e,n){var r,o,s,a,l,c,u,h,d,f,g,p,m,y;if(o=e.childNodes,(d=n.cloneRange()).collapse(!0),(l=n.cloneRange()).collapse(!1),u=d.startContainer,h=d.startOffset,s=l.endContainer,a=l.endOffset,!d.comparePoint)return[u,h,s,a];if(u===e)for(h=(u=o[o.length-1]).textContent.length,c=f=0,p=o.length;f<p;c=++f)if(r=o[c],1===d.comparePoint(r,0)){0===c?(u=r,h=0):(u=o[c-1],h=r.textContent.length),y=u.nodeName.toLowerCase,i.call(t,y)>=0&&(h=1);break}if(n.collapsed)return[u,h,u,h];if(s===e)for(a=(s=o[o.length-1]).textContent.length,c=g=0,m=o.length;g<m;c=++g)r=o[c],1===l.comparePoint(r,0)&&(s=0===c?r:o[c-1],a=r.textContent.length+1);return[u,h,s,a]},"undefined"!=typeof window&&(window.ContentSelect=e),"undefined"!=typeof module&&module.exports&&(module.exports=e)}).call(void 0);var a=e=>("string"==typeof e&&(e=document.querySelector(e)),{ancestor(){const t=this.range();return t?t.commonAncestorContainer:e},container:()=>e,containerRect(){const t=document.createRange();return t.selectNodeContents(e),t.getBoundingClientRect()},end(){return this.start()+this.length()},isWithin(){if(!this.range())return!1;const t=this.ancestor();return t===e||e.contains(t)},length(){return this.text().length},object:()=>document.getSelection(),range(e=!1){const t=this.object();let n=null;if(!t)return null;try{n=t.getRangeAt(0)}catch(e){return null}return!0===e?n.cloneRange():n},rangeAfterCursor(){const t=this.range(),n=this.range(!0);return t&&n?(n.selectNodeContents(e),n.setStart(t.endContainer,t.endOffset),n):null},rangeBeforeCursor(){const t=this.range(),n=this.range(!0);return t&&n?(n.selectNodeContents(e),n.setEnd(t.startContainer,t.startOffset),n):null},rect(){const e=this.range();return!!e&&e.getBoundingClientRect()},select(t,n){n=n||t,new ContentSelect.Range(t,n).select(e)},start(){const e=this.rangeBeforeCursor();return e?e.toString().length:0},text(){const e=this.range();return e?e.toString():""}});export default(n,r)=>{"string"==typeof n&&(n=document.querySelector(n));const o={autofocus:!1,breaks:!0,formats:{},history:100,onBlur:()=>{},onChange:()=>{},onFocus:()=>{},onKeydown:()=>{},onKeyup:()=>{},onMousedown:()=>{},onMouseup:()=>{},onRedo:()=>{},onSelection:()=>{},onSelectionEnd:()=>{},onSelectionStart:()=>{},onUndo:()=>{},placeholder:"",shortcuts:{},spellcheck:!0,triggers:{},...r},l={...t,...o.formats},c=(e,t,n)=>{R(),n&&n.start&&E(n.start,n.length)},u=i(n,{formats:l,history:o.history,onRedo:(e,t,n)=>{c(0,0,n),o.onRedo(e,t,n)},onUndo:(e,t,n)=>{c(0,0,n),o.onUndo(e,t,n)},triggers:o.triggers}),h=a(n),d=e(n,h);let f=!1;n.setAttribute("contenteditable",!0),n.setAttribute("data-placeholder",o.placeholder),n.setAttribute("spellcheck",o.spellcheck);const g={bold(){y("bold")},code(){y("code")},delete(){let e=h.start(),t=h.length();0===t&&(e-=1,t=1,e<0)||(u.removeText(e,t),R(),E(e))},deleteForward(){let e=h.start(),t=h.length();0===t&&(t=1),u.removeText(e,t),R(),E(e)},enter(){if(!0!==o.breaks)return!1;const e=d.position();u.insertText("\n",e),R(),E(e+1)},insert(e,t){u.insertText(e,t),R(),E(t+e.length)},italic(){y("italic")},link(e){const t=h.start(),n=h.length();u.addFormat("link",t,n,{href:e}),R(),E(t,n)},paste(e){let t=d.position(),n=document.createElement("div");n.innerHTML=e;const r=s(n,l);u.inject(r,t),R(),E(t+r.length)},strikeThrough(){y("strikeThrough")},subscript(){y("subscript")},superscript(){y("superscript")},unlink(){const e=h.start(),t=h.length();u.removeFormat("link",e,t),R(),E(e,t)}},p=(e,...t)=>"function"==typeof e?e.call(...t):g[e]?g[e](...t):void 0,m=e=>{E(e)},y=(e,t)=>{const n=h.start(),r=h.length();u.toggleFormat(e,n,r,t),R(),E(n,r)},v=()=>{!0===f&&(f=!1,o.onSelectionEnd(event))},N=()=>{!1===f&&(f=!0,o.onSelectionStart(event))},b=()=>{u.redo()},E=(e,t)=>{switch(e){case"end":e=u.length();break;case"start":e=0}f=!0,h.select(e,e+(t||0))},O=()=>{u.undo()},R=()=>{const e=u.toHtml();n.innerHTML=e,o.onChange(e)};n.addEventListener("blur",o.onBlur),n.addEventListener("focus",o.onFocus),n.addEventListener("mousedown",o.onMousedown),document.addEventListener("selectionchange",e=>{h.isWithin()?(N(),o.onSelection(e)):v()}),n.addEventListener("mouseup",e=>{o.onMouseup(e),v()}),n.addEventListener("keyup",e=>{o.onKeyup(e),v()});const S={Delete:"deleteForward",Backspace:"delete",Enter:"enter","Meta+b":"bold","Meta+i":"italic","Meta+x":"delete","Shift+Enter":"enter",...o.shortcuts||{}};return n.addEventListener("paste",e=>{e.preventDefault();const t=e.clipboardData||window.clipboardData,n=t.getData("text/html")||t.getData("text");h.length()>0&&p("delete"),p("paste",n)}),n.addEventListener("keydown",e=>{o.onKeydown(e);let t=[];if(!0===e.metaKey&&t.push("Meta"),!0===e.altKey&&t.push("Alt"),!0===e.ctrlKey&&t.push("Ctrl"),!0===e.shiftKey&&t.push("Shift"),t.push(e.key),t=t.join("+"),["Backspace","Delete"].includes(e.key)&&(t=e.key),"Meta+z"===t)return e.preventDefault(),void O();if("Meta+Shift+z"===t)return e.preventDefault(),void b();if(h.length()>0&&!1===e.ctrlKey&&!1===e.metaKey&&1===e.key.length&&p("delete"),S[t]){p(S[t])||e.preventDefault()}}),n.addEventListener("input",e=>{switch(e.inputType){case"historyRedo":b();break;case"historyUndo":O();break;case"insertText":p("insert",e.data,d.position()-1)}}),n.innerHTML=u.toHtml(),o.autofocus&&m(),{activeFormats:()=>{const e=h.start(),t=h.length();return u.activeFormats(e,t)},activeLink:()=>{const e=h.start(),t=h.length();return u.activeLink(e,t)},command:p,cursor:d,doc:u,element:n,focus:m,options:o,redo:b,select:E,selection:h,toHtml:(e,t)=>u.toHtml(e,t),toJson:(e,t)=>u.toJson(e,t),toText:(e,t)=>u.toText(e,t),undo:O,update:R}};
