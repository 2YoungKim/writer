<link rel="stylesheet" href="./demo/Demo.css">
<link rel="stylesheet" href="./src/Writer.css">
<style>

  .k-writer {
    padding: 3rem;
  }

  .toolbar {
    position: absolute;
    display: none;
    border-radius: 3px;
    background: #000;
    color: #fff;
    box-shadow: rgba(0,0,0, .25) 0 5px 10px;
  }
  .toolbar hr {
    border: 0;
    width: 1px;
    background: rgba(255,255,255, .25);
  }
  .toolbar button {
    border: 0;
    background: none;
    padding: .5rem;
    color: currentColor;
    cursor: pointer;
  }
  .toolbar button.active {
    color: #7e9abf;
  }

</style>

<main class="layout">

  <div>
    <div class="toolbar">
      <button data-command="bold">B</button>
      <button data-command="italic"><i>i</i></button>
      <button data-command="strikeThrough"><del>S</del></button>
      <hr>
      <button data-command="code">Code</button>
      <hr>
      <button data-command="link"><u>Link</u></button>
    </div>

    <div class="k-writer" spellcheck="false" contenteditable><p>Lorem <a href="https://getkirby.com">ipsum dolor</a> <strong><i>s</i>it</strong> amet, consetetur sadipscing <i>elitr</i>, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo</p></div>
  </div>

  <code><pre class="preview"></pre></code>

</main>

<a class="github" href="https://github.com/getkirby/writer"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_white_ffffff.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>

<script type="module">
import Toolbar from "./src/Toolbar.js";
import Writer from "./src/Writer.js";

const preview = document.querySelector(".preview");

/**
 * Creates a new link
 */
const createLink = () => {
  let href = null;
  let link = writer.activeLink();

  if (link) {
    href = link.href;
  }

  const url = prompt("Please enter a URL", href || "");

  if (url) {
    writer.command("link", url);
  } else if (url !== null) {
    writer.command("unlink");
  }

  toolbar.hide();

};

/**
 * Toolbar
 */
const toolbar = Toolbar(".toolbar", (command) => {
  if (command === "link") {
    createLink();
  } else {
    writer.command(command);
  }
});

/**
 * Writer instance
 */
const writer  = Writer(".k-writer", {
  breaks: true,
  onChange() {
    preview.innerHTML = JSON.stringify(writer.toJson(), null, 4);
  },
  onMousedown() {
    toolbar.hide();
  },
  onSelection() {
    toolbar.activeFormats(writer.activeFormats());
  },
  onSelectionEnd() {
    const rect = writer.selection.rect();

    if (writer.selection.length() > 0) {
      toolbar.show(rect);
    } else {
      toolbar.hide();
    }
  },
  shortcuts: {
    "Meta+k": () => {
      createLink();
    }
  }
});

/**
 * Update the preview with the right
 * document state after the writer gets
 * initialized. This is only necessary
 * for this demo or if you want to trigger
 * the onChange event immediately.
 */
writer.update();

</script>
