<link rel="stylesheet" href="./src/Writer.css">
<style>

  * {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    padding: 0;
    margin: 0;
  }

  .k-writer {
    height: 100%;
    border: 0;
    padding: 3rem;
  }

  .k-writer:focus {
    outline: none;
  }

  .layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    height: 100%;
  }

  .preview {
    padding: .5rem;
    white-space: pre-wrap;
    background: #000;
    min-height: 100%;
    color: #fff;
    font-family: "SFMono-Regular", Consolas, Liberation Mono, Menlo, Courier, monospace;
  }

  .github {
    position: absolute;
    top: 0;
    right: 0;
  }

  .toolbar {
    position: absolute;
    display: none;
    border-radius: 3px;
    background: #000;
    color: #fff;
    box-shadow: rgba(0,0,0, .25) 0 5px 10px;
  }
  .toolbar hr {
    border: 0;
    width: 1px;
    background: rgba(255,255,255, .25);
  }
  .toolbar button {
    border: 0;
    background: none;
    padding: .5rem;
    color: currentColor;
    cursor: pointer;
  }
  .toolbar button.active {
    color: #7e9abf;
  }

</style>

<main class="layout">

  <div>
    <div class="toolbar">
      <button data-command="bold">B</button>
      <button data-command="italic"><i>i</i></button>
      <button data-command="strikeThrough"><del>S</del></button>
      <hr>
      <button data-command="code">Code</button>
      <hr>
      <button data-command="link"><u>Link</u></button>
    </div>

    <div class="k-writer"></div>
  </div>

  <code><pre class="preview"></pre></code>

</main>

<a class="github" href="https://github.com/getkirby/writer"><img width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_white_ffffff.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>

<script type="module">
import Toolbar from "./src/Toolbar.js";
import Writer from "./src/Writer.js";

const preview = document.querySelector(".preview");

/**
 * Creates a new link
 */
const createLink = () => {
  let href = null;
  let link = writer.activeLink();

  if (link) {
    href = link.href;
  }

  const url = prompt("Please enter a URL", href || "");

  if (url) {
    writer.command("link", url);
  } else if (url !== null) {
    writer.command("unlink");
  }

  toolbar.hide();

};

/**
 * Toolbar
 */
const toolbar = Toolbar(".toolbar", (command) => {
  if (command === "link") {
    createLink();
  } else {
    writer.command(command);
  }
});

const updatePreview = () => {
  preview.innerHTML = JSON.stringify(writer.toJson(), null, 4);
};

/**
 * Writer instance
 */
window.writer = Writer(".k-writer", {
  breaks: true,
  onChange() {
    updatePreview();
  },
  onMousedown() {
    toolbar.hide();
  },
  onSelection() {
    toolbar.activeFormats(writer.activeFormats());
  },
  onSelectionEnd() {
    const rect = writer.selection.rect();

    if (writer.selection.length() > 0) {
      toolbar.show(rect);
    } else {
      toolbar.hide();
    }
  },
  placeholder: "Start writing â€¦",
  shortcuts: {
    "Meta+k": () => {
      createLink();
    }
  },
  spellcheck: false
});

/**
 * Update the preview with the right
 * document state after the writer gets
 * initialized. This is only necessary
 * for this demo or if you want to trigger
 * the onChange event immediately.
 */
updatePreview();

</script>
